extends main_nonacademic

block content
    .container-fluid.py-4
        .row
            .col-xl-3.col-sm-6.mb-xl-0.mb-4
                .card
                    .card-body.p-3
                        .row
                            .col-8
                                .numbers
                                    p.text-sm.mb-0.text-uppercase.font-weight-bold My Lectures
                                    h5.font-weight-bolder
                                    | 5 Modules
                                    p.mb-0
                                    span.text-success.text-sm.font-weight-bolder 3
                                    |                       Groups
                            .col-4.text-end
                                .icon.icon-shape.bg-gradient-primary.shadow-primary.text-center.rounded-circle
                                    i.ni.ni-books.text-lg.opacity-10(aria-hidden='true')
            .col-xl-3.col-sm-6.mb-xl-0.mb-4
                .card
                    .card-body.p-3
                        .row
                            .col-8
                                .numbers
                                    p.text-sm.mb-0.text-uppercase.font-weight-bold Weekly Sessions
                                    h5.font-weight-bolder
                                    | 5
                                    p.mb-0
                                    span.text-danger.text-sm.font-weight-bolder 2
                                    |                       Sessions Left
                            .col-4.text-end
                                .icon.icon-shape.bg-gradient-success.shadow-success.text-center.rounded-circle
                                    i.ni.ni-calendar-grid-58.text-lg.opacity-10(aria-hidden='true')
            .col-xl-3.col-sm-6.mb-xl-0.mb-4
                .card
                    .card-body.p-3
                        .row
                            .col-8
                                .numbers
                                    p.text-sm.mb-0.text-uppercase.font-weight-bold Total Students
                                    h5.font-weight-bolder
                                    | 456 Students
                                    p.mb-0
                                    span.text-success.text-sm.font-weight-bolder 86%
                                    |                       Attendance
                            .col-4.text-end
                                .icon.icon-shape.bg-gradient-danger.shadow-danger.text-center.rounded-circle
                                    i.ni.ni-single-02.text-lg.opacity-10(aria-hidden='true')
            .col-xl-3.col-sm-6
                .card
                    .card-body.p-3
                        .row
                            .col-8
                                .numbers
                                    p.text-sm.mb-0.text-uppercase.font-weight-bold Semester Average
                                    h5.font-weight-bolder
                                    | 75% Presence
                                    p.mb-0
                                    | Out of 
                                    span.text-success.text-sm.font-weight-bolder 800
                                    |  Students
                            .col-4.text-end
                                .icon.icon-shape.bg-gradient-warning.shadow-warning.text-center.rounded-circle
                                    i.ni.ni-watch-time.text-lg.opacity-10(aria-hidden='true')
        .row.mt-4
            .col-lg-4
                .card.pb-0
                    .card-header.pb-0.pt-3.bg-transparent
                        h6.text-capitalize This Semester Attendance
                    .card-body.p-3
                        ul.list-group
                            li.list-group-item.border-0.d-flex.justify-content-between.ps-0.border-radius-lg
                                .d-flex.align-items-center
                                    .d-flex.flex-column
                                        h6.mb-1.text-dark.text-sm Module
                                        select#modules_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1(onchange = "onModuleSelect()")
                                            each val in modules
                                                option(value=val.id) #{val.Code} - #{val.Name}
                            li.list-group-item.border-0.d-flex.justify-content-between.ps-0.border-radius-lg
                                .d-flex.align-items-center
                                    .d-flex.flex-column
                                        h6.mb-1.text-dark.text-sm Batch
                                        select#batch_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1(onchange = "onBatchSelect()")
                                            each val in batches
                                                //option(value='#{val.id}') Batch #{val.Batch}
                            li.list-group-item.border-0.d-flex.justify-content-between.ps-0.border-radius-lg
                                .d-flex.align-items-center
                                    .d-flex.flex-column
                                        h6.mb-1.text-dark.text-sm Group
                                        select#group_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1
                                            each val in groups
                                                //option(value='#{val.id}') #{val.Name}
                            li.list-group-item.border-0.d-flex.justify-content-between.ps-0.border-radius-lg
                                .d-flex.align-items-center
                                    .d-flex.flex-column
                                        h6.mb-1.text-dark.text-sm Degree
                                        select.form-select.text-xs.me-8.pe-5.ms-0.mt-1
                                            //option(value='1') Information Technology
                                            //option(value='1') Information Technology And Management
                                            //option(value='1') Artificial Intelligence
                        .card-header.pb-0.mb-0
                            .d-flex.align-items-center
                                button.btn.btn-primary.btn-sm.ms-auto Apply Filters
            .col-lg-8.mb-lg-0.mb-0
                .card.z-index-2.h-100
                    .card-body.p-3
                        .chart.h-100
                            canvas#chart-line.chart-canvas(height='300')


        .row.mt-4
            .col-lg-0.mb-lg-0.mb-4
                .card
                    .card-header.pb-0.p-3
                        .d-flex.justify-content-between
                        h6.mb-2 This Week Attendance
                    .table-responsive
                        table.table.align-items-center
                            tbody
                                //each val in message
                                    tr
                                    td.w-30
                                        .d-flex.px-2.py-1.align-items-center
                                            div
                                                img(src='../static/assets/img/icons/books.png' alt='Icon')
                                            .ms-4
                                                p.text-xs.font-weight-bold.mb-0 Module:
                                                h6.text-sm.mb-0 Row #{val}
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Batch:
                                        h6.text-sm.mb-0 21
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Group:
                                        h6.text-sm.mb-0 mod5-grp1
                                    td.align-middle.text-sm
                                        .col.text-center
                                        p.text-xs.font-weight-bold.mb-0 Perecentage:
                                        h6.text-sm.mb-0 80.9%
                                tr
                                    td.w-30
                                        .d-flex.px-2.py-1.align-items-center
                                            div
                                                img(src='../static/assets/img/icons/books.png' alt='Icon')
                                            .ms-4
                                                p.text-xs.font-weight-bold.mb-0 Module:
                                                h6.text-sm.mb-0 Introduction to Databases
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Batch:
                                        h6.text-sm.mb-0 21
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Group:
                                        h6.text-sm.mb-0 mod5-grp1
                                    td.align-middle.text-sm
                                        .col.text-center
                                        p.text-xs.font-weight-bold.mb-0 Perecentage:
                                        h6.text-sm.mb-0 80.9%
                                tr
                                    td.w-30
                                        .d-flex.px-2.py-1.align-items-center
                                            div
                                                img(src='../static/assets/img/icons/books.png' alt='Icon')
                                            .ms-4
                                                p.text-xs.font-weight-bold.mb-0 Module:
                                                h6.text-sm.mb-0 Elements of Probability And Statistics
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Batch:
                                        h6.text-sm.mb-0 20
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Group:
                                        h6.text-sm.mb-0 mod2-grp2
                                    td.align-middle.text-sm
                                        .col.text-center
                                        p.text-xs.font-weight-bold.mb-0 Perecentage:
                                        h6.text-sm.mb-0 75.9%
                                tr
                                    td.w-30
                                        .d-flex.px-2.py-1.align-items-center
                                            div
                                                img(src='../static/assets/img/icons/books.png' alt='Icon')
                                            .ms-4
                                                p.text-xs.font-weight-bold.mb-0 Module:
                                                h6.text-sm.mb-0 Programming Fundamentals
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Batch:
                                        h6.text-sm.mb-0 21
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Group:
                                        h6.text-sm.mb-0 mod3-grp1
                                    td.align-middle.text-sm
                                        .col.text-center
                                        p.text-xs.font-weight-bold.mb-0 Perecentage:
                                        h6.text-sm.mb-0 60%
                                tr
                                    td.w-30
                                        .d-flex.px-2.py-1.align-items-center
                                            div
                                                img(src='../static/assets/img/icons/books.png' alt='Icon')
                                            .ms-4
                                                p.text-xs.font-weight-bold.mb-0 Module:
                                                h6.text-sm.mb-0 Digital Systems Design
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Batch:
                                        h6.text-sm.mb-0 21
                                    td
                                        .text-center
                                        p.text-xs.font-weight-bold.mb-0 Group:
                                        h6.text-sm.mb-0 mod2-grp1
                                    td.align-middle.text-sm
                                        .col.text-center
                                        p.text-xs.font-weight-bold.mb-0 Perecentage:
                                        h6.text-sm.mb-0 90%

    script.

        var modules,batches,groups;
        $(document).ready(function() {
            modules = JSON.parse(JSON.stringify(!{JSON.stringify(modules)}));
            batches = JSON.parse(JSON.stringify(!{JSON.stringify(batches)}));
            groups = JSON.parse(JSON.stringify(!{JSON.stringify(groups)}));
            console.log(modules);
            onModuleSelect();
        });


        // Loading the chart
        var ctx1 = document.getElementById("chart-line").getContext("2d");
        var gradientStroke1 = ctx1.createLinearGradient(0, 230, 0, 50);
        gradientStroke1.addColorStop(1, 'rgba(94, 114, 228, 0.3)');
        gradientStroke1.addColorStop(0.2, 'rgba(94, 114, 228, 0.0)');
        gradientStroke1.addColorStop(0, 'rgba(94, 114, 228, 0)');
        var arr = [];
        for(let i=1;i<=12;i++){
            arr.push((i^5));
        }
        new Chart(ctx1, {
            type: "line",
            data: {
                //labels: ["2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01"],
                labels: ["#{message}", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01", "2023-01-01"],
                datasets: [{
                    label: "Percentage",
                    tension: 0.3,
                    borderWidth: 0,
                    pointRadius: 4,
                    borderColor: "#5e72e4",
                    backgroundColor: gradientStroke1,
                    borderWidth: 2,
                    fill: true,
                    data: arr,
                    maxBarThickness: 6,
                }],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false,
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                scales: {
                    y: {
                        grid: {
                            drawBorder: false,
                            display: true,
                            drawOnChartArea: true,
                            drawTicks: true,
                            borderDash: [5, 5],
                        },
                        ticks: {
                            display: true,
                            padding: 10,
                            color: '#333',
                            font: {
                                size: 11,
                                family: "Open Sans",
                                style: 'normal',
                                lineHeight: 2
                            },
                        },
                        title: {
                            text: 'Attendance Percentage',
                            display: true,
                            color: '#222',
                            font: {
                                size: 15,
                                family: "Open Sans",
                                style: 'normal',
                                lineHeight: 2
                            }
                        }
                    },
                    x: {
                        grid: {
                            drawBorder: false,
                            display: false,
                            drawOnChartArea: false,
                            drawTicks: false,
                            borderDash: [5, 5],
                            label: 'Sessions',
                        },
                        ticks: {
                            display: true,
                            color: '#333',
                            padding: 20,
                            font: {
                                size: 11,
                                family: "Open Sans",
                                style: 'normal',
                                lineHeight: 2
                            },
                        },
                        title: {
                            text: 'Sessions',
                            display: true,
                            color: '#222',
                            font: {
                                size: 15,
                                family: "Open Sans",
                                style: 'normal',
                                lineHeight: 2
                            }
                        }
                    },
                },
            },
        });

        // Modules select change event
        function onModuleSelect(){
            var module_select_view = document.getElementById("modules_select");
            var batch_select_view = document.getElementById("batch_select");
            clearSelectOptions(batch_select_view);
            let selected_module = module_select_view.value;
            console.log(selected_module);

            let matching_batches = [];
            let ava_in_array;
            for(let obj in groups){
                if(groups[obj].Module == selected_module){
                    ava_in_array =false;
                    for(let batch in matching_batches){
                        if(matching_batches[batch] == groups[obj].Batch){
                            ava_in_array = true;
                            break;
                        }
                    }
                    if(ava_in_array==false){
                        matching_batches.push(groups[obj].Batch);
                    }
                }
            }

            console.log('batches : ' + matching_batches);

            let batch_name;
            for(let batch in matching_batches){
                batch_name = batches.filter((batches) => {
                    return batches.id == matching_batches[batch];
                });
                batch_select_view.add(new Option('Batch ' + batch_name[0].Batch,batch_name[0].id),undefined);
                console.log(batch_name);
            }

            onBatchSelect();
        }

        function onBatchSelect(){
            var module_select_view = document.getElementById("modules_select");
            var batch_select_view = document.getElementById("batch_select");
            var group_select_view = document.getElementById("group_select");

            let selected_module = module_select_view.value;
            let selected_batch = batch_select_view.value;

            clearSelectOptions(group_select_view);
            for(let grp in groups){ 
                if(groups[grp].Batch == selected_batch && groups[grp].Module == selected_module){
                    group_select_view.add(new Option(groups[grp].id,groups[grp].id),undefined);
                }
            }
        }

        function clearSelectOptions(element){
            element.innerHTML = "";
        }

    script.
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = {
                damping: '0.5'
            }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }