extends main_nonacademic

block content

    .container-fluid.py-4
        .row
            .col-lg-0.mb-xl-0.mb-4
                .card
                    .card-header.pb-0.pt-3.bg-transparent
                        h6.text-capitalize Time table 
                    .card-body.p-3
                        .row.mt-3.justify-content-center
                            .col-lg-4.col-xs-0
                                .d-flex.align-items-center
                                    .d-flex.flex-column.w-90
                                        h6.text-dark.text-sm Batch
                                        select#batch_select_timetable.form-select.text-xs.me-8.pe-5.ms-0.mt-1.mb-3.lh-lg4(onchange="")
                                            each batch in batches 
                                                option(value=batch.id) Batch #{batch.Batch}
                            .col-lg-4.col-xs-0  
                                .d-flex.align-items-center
                                    .d-flex.flex-column.w-90
                                        h6.text-dark.text-sm Degree
                                        select#degree_select_timetable.form-select.text-xs.me-8.pe-5.ms-0.mt-1.mb-3.lh-lg4(onchange="")           
                                            each degree in degrees 
                                                option(value=degree.id) #{degree.Degree}  
                        row   
                            .col-lg-0.text-center
                                button.btn.btn-primary.btn-sm.mt-3.ps-7.pe-7(onclick="searchTimeTable()") Search
                
                    .row#lectures_row.invisible
                        .col-lg-0.mb-xl-0.mb-4
                            .card-header.pb-0.pt-3.bg-transparent
                                h6.text-capitalize#day_of_week_text Lectures 
                            .card-body.p-3
                                .table-responsive
                                    //Class limited-rows-table - used to specify the max height and make scrollbars visible
                                    table#lectures_table.table.align-items-center  
                                        tbody#lectures_table_body
                                         
                .card.mt-3
                    .card-header.pb-0.pt-3.bg-transparent
                        h6.text-capitalize Sessions 
                    .card-body.p-3
                        .row.mt-3
                            .col-lg-4.col-xs-0
                                .d-flex.align-items-center
                                    .d-flex.flex-column.w-90
                                        h6.text-dark.text-sm Batch
                                        select#module_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1.mb-3.lh-lg4(onchange="searchGroups()")
                                       
                                                    option(value=Batch21) Batch 22  
                                                    option(value=Batch22) Batch 21 
                                                    option(value=Batch21) Batch 20
                                                    option(value=Batch21) Batch 19 
                            .col-lg-4.col-xs-0  
                                .d-flex.align-items-center
                                    .d-flex.flex-column.w-90
                                        h6.text-dark.text-sm Module
                                        select#module_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1.mb-3.lh-lg4(onchange="searchGroups()")
                                       
                                                    option(value="Database") Fundamentals of Databases
                                                    option(value="English") English
                                                    option(value="Maths") Static and Probability  
                            .col-lg-4.col-xs-0  
                                .d-flex.align-items-center
                                    .d-flex.flex-column.w-90
                                        h6.text-dark.text-sm Group
                                        select#module_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1.mb-3.lh-lg4(onchange="searchGroups()")
                                       
                                                    option(value="A1") A1
                                                    option(value="A2") A2
                                                    option(value="A3") A3                      
                       
                        row   
                            .col-lg-0.text-center
                                button.btn.btn-primary.btn-sm.mt-3.ps-7.pe-7(onclick="searchTimeTable()") Search
                       
                    .card-body.p-3
                        .table-responsive
                            //Class limited-rows-table - used to specify the max height and make scrollbars visible
                            table#session_table.table.align-items-center
                                tr  
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4
                                            h6.text-sm.mb-0 Short Time
                                            
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            h6.text-sm.mb-0 Duration
                                           
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            h6.text-sm.mb-0 Method

                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            h6.text-sm.mb-0 Type
                                            
                                              
                                tr  
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                           
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 

                .card.mt-3
                    .card-header.pb-0.pt-3.bg-transparent
                        h6.text-capitalize Attendence  
                    .card-body.p-3
                        .row.mt-3
                            .col-lg-4.col-xs-0  
                                .d-flex.align-items-center
                                    .d-flex.flex-column.w-90
                                        h6.text-dark.text-sm Degree
                                        select#module_select.form-select.text-xs.me-8.pe-5.ms-0.mt-1.mb-3.lh-lg4(onchange="searchGroups()")
                                       
                                                    option(value=IT) Bsc (IT)
                                                    option(value=ITM) Bsc (ITM)
                                                    option(value=AI) Bsc (AI)                
                       
                    
                       
                    .card-body.p-3
                        .table-responsive
                            //Class limited-rows-table - used to specify the max height and make scrollbars visible
                            table#session_table.table.align-items-center
                                tr  
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4
                                            h6.text-sm.mb-0 Student
                                            
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            h6.text-sm.mb-0 Pref..
                                           
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            h6.text-sm.mb-0 Degree

                                  
                                            
                                              
                                tr  
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                            
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
                                           
                                  td 
                                    .d-flex.px-2.py-1.align-items-center
                                        .ms-4 
    
    script.
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = {
                damping: '0.5'
            }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }

        var degrees,batches;

        $(document).ready(function() {
            sideBarChange();
            batches = JSON.parse(JSON.stringify(!{JSON.stringify(batches)}));
            degrees = JSON.parse(JSON.stringify(!{JSON.stringify(degrees)}));
            
        });

        function sideBarChange(){
            document.getElementById("students-nav-link").classList.remove('active');
            document.getElementById("today-nav-link").classList.add('active');
            document.getElementById("pastreports-nav-link").classList.remove('active');
            document.getElementById("employees-nav-link").classList.remove('active');
            document.getElementById("semester-nav-link").classList.remove('active');
        }

        function searchTimeTable(){
            let dayOfWeek = new Date().getDay();
            
            let selectedBatch = document.getElementById("batch_select_timetable").value;
            let selectedDegree = document.getElementById("degree_select_timetable").value;

            $.ajax({
                    type: 'GET',
                    url: '/nac/timetable/getlectures',
                    //headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                    data: {
                        day: dayOfWeek,
                        batch: selectedBatch,
                        degree: selectedDegree,
                    },
                    dataType: 'json',
                    encode: true
                }).done(function (response) {
                    console.log(response);
                    let lectures,groups;
                    if(response.status=='200'){
                        console.log('success');
                        lectures = response.lectures;
                        groups = response.groups;
                        if(lectures.length==0){
                            window.alert("No lectures available for the selected day, batch and degree");
                        }
                        showLecturesTable(lectures, groups)  
                        console.log(lectures);
                        console.log(groups);

                    }else{
                        console.log('error');
                        window.alert("Error occured while loading lectures")
                    }
                });

        }

        // SHOWING LECTURES TABLE
        function showLecturesTable(lectures, groups){
            var lectures_table_row = document.getElementById("lectures_row");
            var lectures_table = document.getElementById("lectures_table_body");
            clearSelectOptions(lectures_table);

            if(lectures.length != 0){
                let row,cell,element_p,element_h6,rowCount;

                for(lec in lectures){
                    rowCount = lectures_table.rows.length;
                    row = lectures_table.insertRow(rowCount);
                    row.classList.add("limited-rows-tr");
                    row.classList.add("selection-row");
                    row.setAttribute("data-id",lectures[lec].id);
                    
                    for(group in groups){
                        if(lectures[lec].T_group == groups[group].id){
                            cell = row.insertCell(0);
                            element_p = document.createElement("p");
                            element_p.classList.add("text-xs");
                            element_p.classList.add("font-weight-bold");
                            element_p.classList.add("mb-0");
                            element_p.innerHTML = 'Module :';
                            cell.appendChild(element_p);
                            element_h6 = document.createElement("h6");
                            element_h6.classList.add("text-sm");
                            element_h6.classList.add("mb-0");
                            element_h6.innerHTML = groups[group].Module;
                            cell.appendChild(element_h6);

                            cell = row.insertCell(1);
                            element_p = document.createElement("p");
                            element_p.classList.add("text-xs");
                            element_p.classList.add("font-weight-bold");
                            element_p.classList.add("mb-0");
                            element_p.innerHTML = 'Group :';
                            cell.appendChild(element_p);
                            element_h6 = document.createElement("h6");
                            element_h6.classList.add("text-sm");
                            element_h6.classList.add("mb-0");
                            element_h6.innerHTML = groups[group].Name;
                            cell.appendChild(element_h6);
                        }
                    }
                    
                    cell = row.insertCell(2);
                    element_p = document.createElement("p");
                    element_p.classList.add("text-xs");
                    element_p.classList.add("font-weight-bold");
                    element_p.classList.add("mb-0");
                    element_p.innerHTML = 'Start Time :';
                    cell.appendChild(element_p);
                    element_h6 = document.createElement("h6");
                    element_h6.classList.add("text-sm");
                    element_h6.classList.add("mb-0");
                    element_h6.innerHTML = lectures[lec].Start_time;
                    cell.appendChild(element_h6);

                    cell = row.insertCell(3);
                    element_p = document.createElement("p");
                    element_p.classList.add("text-xs");
                    element_p.classList.add("font-weight-bold");
                    element_p.classList.add("mb-0");
                    element_p.innerHTML = 'Duration :';
                    cell.appendChild(element_p);
                    element_h6 = document.createElement("h6");
                    element_h6.classList.add("text-sm");
                    element_h6.classList.add("mb-0");
                    element_h6.innerHTML = lectures[lec].Duration;
                    cell.appendChild(element_h6);

                    cell = row.insertCell(4);
                    element_p = document.createElement("p");
                    element_p.classList.add("text-xs");
                    element_p.classList.add("font-weight-bold");
                    element_p.classList.add("mb-0");
                    element_p.innerHTML = 'Method :';
                    cell.appendChild(element_p);
                    element_h6 = document.createElement("h6");
                    element_h6.classList.add("text-sm");
                    element_h6.classList.add("mb-0");
                    if(lectures[lec].Method==0){
                        element_h6.innerHTML = "Physical";
                    }else{
                        element_h6.innerHTML = "Online";
                    }
                    cell.appendChild(element_h6);

                    cell = row.insertCell(5);
                    element_p = document.createElement("p");
                    element_p.classList.add("text-xs");
                    element_p.classList.add("font-weight-bold");
                    element_p.classList.add("mb-0");
                    element_p.innerHTML = 'Session Type :';
                    cell.appendChild(element_p);
                    element_h6 = document.createElement("h6");
                    element_h6.classList.add("text-sm");
                    element_h6.classList.add("mb-0");
                    if(lectures[lec].Type==0){
                        element_h6.innerHTML = "Lecture";
                    }else if(lectures[lec].Type==1){
                        element_h6.innerHTML = "Tutorial/Lab";
                    }else if(lectures[lec].Type==2){
                        element_h6.innerHTML = "Assignment";
                    }else{
                        element_h6.innerHTML = "Examination";
                    }
                    cell.appendChild(element_h6);

                    cell = row.insertCell(6);
                    element_p = document.createElement("p");
                    element_p.classList.add("text-xs");
                    element_p.classList.add("font-weight-bold");
                    element_p.classList.add("mb-0");
                    element_p.innerHTML = 'Session Repeat :';
                    cell.appendChild(element_p);
                    element_h6 = document.createElement("h6");
                    element_h6.classList.add("text-sm");
                    element_h6.classList.add("mb-0");
                    if(lectures[lec].Session_repeat==0){
                        element_h6.innerHTML = "Every Week";
                    }else{
                        element_h6.innerHTML = "Every Other Week";
                    }
                    cell.appendChild(element_h6);
                }

                let days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
                document.getElementById("day_of_week_text").innerHTML = days[new Date().getDay()] + " Time Table"
                lectures_table_row.classList.remove("invisible");
            }else{
                lectures_table_row.classList.add("invisible");
                //window.alert('No sessions for this filter');
            }
            
        }

        function clearSelectOptions(element){
            element.innerHTML = '';
        }
                                            
                                                          
                                                                                               
                               

                            
                            
                        